#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <fcntl.h>
#include <unistd.h>

/* Not technically required, but needed on some UNIX distributions */
#include <sys/types.h>
#include <sys/stat.h>




const char* filename = "/media/edisc/DATA/MinhLong/Edisc/CTF/Pwn/pwnable.kr/input/input";

int main(int argc, char** argv){
    
    char* new_argv[101];
    char* new_envp[2];

    
    // argv
    for (int i = 0; i < 99; ++i)
        new_argv[i] = "a";
        
    new_argv[0] = "input";
    new_argv['A'] = "\x00";
    new_argv['B'] = "\x20\x0a\x0d";
    new_argv[100] = NULL;
    
    // stdio
    int new_stdin = open("./file1", O_RDWR| O_CREAT);
    write(new_stdin, "\x00\x0a\x00\xff", 4);
    
    int new_stderr = open("./file2", O_RDWR | O_CREAT);
    write(new_stderr, "\x00\x0a\x02\xff", 4);
   
    lseek(new_stdin, 0, SEEK_SET);
    lseek(new_stderr, 0, SEEK_SET);

    dup2(new_stdin, 0);
    dup2(new_stderr, 2);
   
    // env
    new_envp[0] = "\xde\xad\xbe\xef=\xca\xfe\xba\xbe";
    new_envp[1] = NULL;

    // File
    int newline = open("./\x0a",O_RDWR |  O_CREAT);
    write(newline, "\x00\x00\x00\x00", 4);
    close(newline);
    

    // Network

    // execute file
    execve(filename, new_argv, new_envp);
    


    return 0;
}
